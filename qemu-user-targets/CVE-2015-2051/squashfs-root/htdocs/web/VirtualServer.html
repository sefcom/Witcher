<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> <html xmlns="http://www.w3c.org/1999/xhtml" xml:lang="zh_TW" lang="zh_TW"> <head> <title>D-LINK</title> <meta http-equiv="X-UA-Compatible" content="IE=9"> <meta http-equiv="Content-Type" content="text/html; charset=utf-8"> <meta http-equiv="Content-Type" content="text/css"> <link rel=stylesheet type="text/css" href="/css/jquery.selectbox.css?v=20150211171738"/> <script type="text/javascript" charset="utf-8" src="/js/initialJS.js?v=20150211171738"></script> <script type="text/javascript" charset="utf-8" src="/js/initialCSS.js?v=20150211171738"></script> <script type="text/javascript" charset="utf-8" src="/js/initialJQ.js?v=20150211171738"></script> <script type="text/javascript" charset="utf-8" src="/js/initialValidate.js?v=20150211171738"></script> <script type="text/javascript" charset="utf-8" src="/js/VirtualServer.js?v=20150211171738"></script> <script type="text/javascript">var HNAP=new HNAP_XML();var Total_ScheduleRules=0;var Limit_VirtualServerRules=15;var Total_Client=0;var Limit_Client=256;var datalist;var lanIP;var submask;function Load_HTML(){$("#header").load("header.html")}function Initial(){initialMenu();initialDetectRouterConnection();datalist=new Datalist()}function GetXML(){HNAP.GetXMLAsync("GetMultipleHNAPs",null,"GetXML",function(a){GetResult_1st(a)})}function GetResult_1st(a){if(a!=null){a.Set("GetMultipleHNAPs/GetScheduleSettings");a.Set("GetMultipleHNAPs/GetClientInfo");a.Set("GetMultipleHNAPs/GetVirtualServerSettings");a.Set("GetMultipleHNAPs/GetRouterLanSettings");HNAP.SetXMLAsync("GetMultipleHNAPs",a,function(b){GetResult_2nd(b)})}else{if(DebugMode==1){alert("[!!GetXML Error!!] Function: GetResult_1st")}}}function GetResult_2nd(l){lanIP=l.Get("GetMultipleHNAPsResponse/GetRouterLanSettingsResponse/RouterIPAddress");submask=l.Get("GetMultipleHNAPsResponse/GetRouterLanSettingsResponse/RouterSubnetMask");var r=l.Get("GetMultipleHNAPsResponse/GetMultipleHNAPsResult");if(r=="OK"){var q=l.Get("GetMultipleHNAPsResponse/GetScheduleSettingsResponse/ScheduleInfoLists#");Total_ScheduleRules=q;var e=document.getElementById("vs_Schedule");for(var u=1;u<=Total_ScheduleRules;u++){var v=decode_char_text(l.Get("GetMultipleHNAPsResponse/GetScheduleSettingsResponse/ScheduleInfoLists:"+u+"/ScheduleName"));e.options.add(new Option(v,v))}Total_Client=l.Get("GetMultipleHNAPsResponse/GetClientInfoResponse/ClientInfoLists/ClientInfo#");var g=document.getElementById("select_vs_LocalIP");var p=1;for(var t=1;t<=Total_Client;t++){var n=l.Get("GetMultipleHNAPsResponse/GetClientInfoResponse/ClientInfoLists/ClientInfo:"+t+"/DeviceName");var y=l.Get("GetMultipleHNAPsResponse/GetClientInfoResponse/ClientInfoLists/ClientInfo:"+t+"/IPv4Address");if(n==""){n="Unknown"}if(y!=""){g.options.add(new Option(y+" ("+n+")",p));p++}}var h=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo#");for(var s=1;s<=h;s++){var o=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/Enabled");var w=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/VirtualServerDescription");var c=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/LocalIPAddress");var m=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/ProtocolType");var b=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/ProtocolNumber");var f=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/ExternalPort");var a=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/InternalPort");var d=l.Get("GetMultipleHNAPsResponse/GetVirtualServerSettingsResponse/VirtualServerList/VirtualServerInfo:"+s+"/ScheduleName");var x=new Data(decode_char_text(w),c,m,b,f,a,decode_char_text(d));x.setEnable(o);datalist.push(x)}check_TotalRule(Limit_VirtualServerRules,datalist.length());$("#select_vs_Name").selectbox();$("#select_vs_LocalIP").selectbox();$("#vs_Protocol").selectbox();$("#vs_Schedule").selectbox();CheckNetworkStatus();document.getElementById("main").style.display="inline";$("select").change(function(){save_button_changed()});$("input").keydown(function(){save_button_changed()});$("input").change(function(){save_button_changed()})}else{if(DebugMode==1){alert("[!!GetXML Error!!] Function: GetResult_2nd")}}}function CheckConnectionStatus(){$.ajax({cache:false,url:"./js/CheckConnection",timeout:5000,type:"GET",success:function(a){SetXML()},error:function(){document.getElementById("DetectRouterConnection").style.display="inline"}})}function SetXML(){document.getElementById("CreatePopAlertMessage").style.display="inline";HNAP.GetXMLAsync("SetVirtualServerSettings",null,"GetXML",function(a){SetResult_1st(a)})}function SetResult_1st(a){if(a!=null){for(var b=0;b<datalist.length();b++){a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/Enabled",datalist.list[b].enable);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/VirtualServerDescription",encode_char_text(datalist.list[b].name));a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/LocalIPAddress",datalist.list[b].ipAddress);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/ProtocolType",datalist.list[b].protocol);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/ProtocolNumber",datalist.list[b].protocolNum);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/ExternalPort",datalist.list[b].externalPort);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/InternalPort",datalist.list[b].internalPort);a.Set("SetVirtualServerSettings/VirtualServerList/VirtualServerInfo:"+(b+1)+"/ScheduleName",encode_char_text(datalist.list[b].schedule))}HNAP.SetXMLAsync("SetVirtualServerSettings",a,function(c){SetResult_2nd(c)})}else{if(DebugMode==1){alert("[!!SetXML Error!!] Function: SetResult_1st")}}}function SetResult_2nd(b){var a=b.Get("SetVirtualServerSettingsResponse/SetVirtualServerSettingsResult");if(a=="OK"){setTimeout("waitSettingFinished()",1000)}if(a=="ERROR"){if(DebugMode==1){alert("[!!SetXML Error!!] Function: SetResult_2nd")}window.location.reload()}}function waitSettingFinished(){window.location.reload()}function createUserButton(){$("#popTitle").html(I18N("j","Create New Rule"));document.getElementById("createPop").style.display="inline";document.getElementById("create_ExternalPort").style.display="table-row";document.getElementById("create_InternalPort").style.display="table-row";document.getElementById("createButton").disabled=true;$("#virtualserver_form").val(-1)}function closeCreateRulePOP(b){var j=false;var a=$("#vs_Name").val();var d=$("#vs_LocalIP").val();var i=$("#vs_Protocol").val();var h=$("#vs_ProtocolNumber").val();var g=$("#vs_ExternalPort").val();var f=$("#vs_InternalPort").val();var e=$("#vs_Schedule").val();if(i==""){g="";f=""}var c=new Data(a,d,i,h,g,f,e);if(b<0){j=datalist.push(c)}else{j=datalist.editData(b,c)}if(j){resetRulePOP();check_TotalRule(Limit_VirtualServerRules,datalist.length())}}function clearCreateRulePOP(){resetRulePOP();$("#virtualserver_form").validate().resetForm();$(":text").prop("className","styled-text");check_TotalRule(Limit_VirtualServerRules,datalist.length())}function resetRulePOP(){document.getElementById("createPop").style.display="none";$("select").selectbox("detach");$("input").val("");$("#select_vs_Name").val("0");$("#select_vs_LocalIP").val("0");$("#vs_Protocol").val("6");vs_Protocol_Description(6);$("#vs_Schedule").val("Always");$("select").selectbox("attach")}function editData(c){$("#popTitle").html(I18N("j","Edit Rule"));document.getElementById("createPop").style.display="inline";document.getElementById("createButton").disabled=true;$("#virtualserver_form").val(c);var b=datalist.getData(c);document.getElementById("vs_Name").value=b.name;document.getElementById("vs_LocalIP").value=b.ipAddress;document.getElementById("vs_ExternalPort").value=b.externalPort;document.getElementById("vs_InternalPort").value=b.internalPort;var a=b.protocolNum;if(b.protocol=="Other"){a="";vs_Protocol_Description(a);$("#vs_ProtocolNumber").val(b.protocolNum)}else{vs_Protocol_Description(a)}$("#vs_Protocol").selectbox("detach");$("#vs_Protocol").val(a);$("#vs_Protocol").selectbox("attach")}function deleteData(a){datalist.deleteData(a);check_TotalRule(Limit_VirtualServerRules,datalist.length());save_button_changed()}function vs_Name_Description(b,c){var a=b.options[c].text;if(c=="0"){document.getElementById("vs_Name").value=""}else{document.getElementById("vs_Name").value=a}$("#vs_Protocol").selectbox("detach");$("#vs_Protocol").val(6);$("#vs_Protocol").selectbox("attach");switch(c){case"0":document.getElementById("vs_ExternalPort").value="";document.getElementById("vs_InternalPort").value="";break;case"1":document.getElementById("vs_ExternalPort").value="23";document.getElementById("vs_InternalPort").value="23";break;case"2":document.getElementById("vs_ExternalPort").value="80";document.getElementById("vs_InternalPort").value="80";break;case"3":document.getElementById("vs_ExternalPort").value="443";document.getElementById("vs_InternalPort").value="443";break;case"4":document.getElementById("vs_ExternalPort").value="21";document.getElementById("vs_InternalPort").value="21";break;case"5":$("#vs_Protocol").selectbox("detach");$("#vs_Protocol").val(17);$("#vs_Protocol").selectbox("attach");$("#vs_ProtocolNumber").val(17);document.getElementById("vs_ExternalPort").value="53";document.getElementById("vs_InternalPort").value="53";break;case"6":document.getElementById("vs_ExternalPort").value="25";document.getElementById("vs_InternalPort").value="25";break;case"7":document.getElementById("vs_ExternalPort").value="110";document.getElementById("vs_InternalPort").value="110";break;case"8":document.getElementById("vs_ExternalPort").value="1720";document.getElementById("vs_InternalPort").value="1720";break;case"9":document.getElementById("vs_ExternalPort").value="3389";document.getElementById("vs_InternalPort").value="3389";break;case"10":document.getElementById("vs_ExternalPort").value="1723";document.getElementById("vs_InternalPort").value="1723";break;case"11":$("#vs_Protocol").selectbox("detach");$("#vs_Protocol").val(17);$("#vs_Protocol").selectbox("attach");$("#vs_ProtocolNumber").val(17);document.getElementById("vs_ExternalPort").value="1701";document.getElementById("vs_InternalPort").value="1701";break;case"12":$("#vs_Protocol").selectbox("detach");$("#vs_Protocol").val(17);$("#vs_Protocol").selectbox("attach");$("#vs_ProtocolNumber").val(17);document.getElementById("vs_ExternalPort").value="9";document.getElementById("vs_InternalPort").value="9";break}}function vs_LocalIP_Description(c,e){var b=c.options[e].text;var d=b.split("(")[0];var a=d.replace(/\s/g,"");if(e=="0"){document.getElementById("vs_LocalIP").value=""}else{document.getElementById("vs_LocalIP").value=a}$("#vs_LocalIP").valid()}function vs_Protocol_Description(a){$("#vs_ProtocolNumber").val(a);if(a==""){document.getElementById("create_ProtocolNumber").style.display="table-row";document.getElementById("create_ExternalPort").style.display="none";document.getElementById("create_InternalPort").style.display="none"}else{document.getElementById("create_ProtocolNumber").style.display="none";document.getElementById("create_ExternalPort").style.display="table-row";document.getElementById("create_InternalPort").style.display="table-row"}}function CheckNetworkStatus(){var a=sessionStorage.getItem("networkStatus");if((a==1)&&(currentDevice.helpVer!="")){document.getElementById("Get_Help").style.display="inline"}else{document.getElementById("Get_Help").style.display="none"}}function focusToFirstIndex(a){if(a.id=="save_buttonFocus"){if(window.event.keyCode==9){document.getElementById("vs_Name").focus()}}}function save_button_changed(){document.getElementById("Save_Disable_btn").style.display="none";document.getElementById("Save_btn").style.display="block";changeFlag=true;checkFlag=true;GetClickTime()}function check_TotalRule(a,c){var b=a-c;document.getElementById("RemainingRules").innerHTML=b;if(b==0){$("#createButton").attr("class","styled_button_dis").attr("disabled",true)}else{$("#createButton").attr("class","styled_button_s").attr("disabled",false)}}$(document).ready(function(){Load_HTML();Initial();setMenu("menu_Advanced");GetXML();checkTimeout()});</script> </head> <body> <div id="wrapper"> <div id="header"></div> <div id="menu"></div> <div id="menu_edge"></div> <div id="content"> <div id="info"> <div id="FunctionName"><script>I18N("h","Virtual Server");</script></div> <div id="wallimage"><img src="image/page_VirtualServer.png?v=20150211171738" alt="" width="195" height="119"/></div> <div id="directions"> <script>I18N("h","Your router helps share a single IP address assigned by your Internet service provider among several clients in your home. Virtual servers are preset port mappings for popular services, like a web or e-mail server, that route traffic to a specified client inside.");</script> <label id="Get_Help" onClick="showOnlineHelp('Virtual Server');" style="cursor:pointer;display:none;text-Decoration:underline"><script>I18N("h","Click here for help.");</script></label> </div> </div> <div id="funcBar"> <div id="pagePath"><script>I18N("h","Advanced");</script> >> <script>I18N("h","Virtual Server");</script></div> <ul id="rightFunc"> <li style="display:block"><div id="Save_btn" onclick="CheckConnectionStatus();" style="cursor:pointer; display:none"><script>I18N("h","Save");</script></div></li> <li style="display:block"><div id="Save_Disable_btn"><script>I18N("h","Save");</script></div></li> <li style="display:block"><a href="javascript:CheckHTMLStatus('PortForwarding');" style="text-decoration:none;" onclick="return confirmExit()"><div id="page_btn" class="linkstyle_1"><script>I18N("h","Port Forwarding");</script></div></a></li> </ul> </div> <div id="main" style="display:none"> <form action="VirtualServer.html" method="get"> <table class="mainTable" border="0" cellspacing="0" id="tblVirtualServer"> <thead> <tr> <th><script>I18N("h","Status");</script></th> <th><script>I18N("h","Name");</script></th> <th><script>I18N("h","Local IP");</script></th> <th><script>I18N("h","Protocol");</script></th> <th><script>I18N("h","External Port");</script></th> <th><script>I18N("h","Internal Port");</script></th> <th><script>I18N("h","Schedule");</script></th> <th><script>I18N("h","Edit");</script></th> <th><script>I18N("h","Delete");</script></th> </tr> </thead> <tbody></tbody> </table> <br/> <br/> <button type="button" name="createButton" id="createButton" class="styled_button_s" onclick="createUserButton()"><script>I18N("h","Add Rule");</script></button> &nbsp;&nbsp;<script>I18N("h","Remaining");</script>:&nbsp;<label id="RemainingRules">10</label> </form> <form name="virtualserver_form" id="virtualserver_form" action=""> <input id="sumbit_CheckData" class="submit" type="submit" value="Submit" style="display:none"/> <div id="createPop" style="display:none"> <div class="dialogBox" style="width:616px"> <div id="closeCreatePopBtn" onclick="clearCreateRulePOP()" style="cursor:pointer"></div> <table class="myCreatePop_table" border="0" cellspacing="0" id="tblVirtualServer3"> <tbody> <tr> <td colspan="3"><div class="popTitle" id="popTitle"></div></td> </tr> <tr> <th><script>I18N("h","Name");</script>:</th> <td valign="top" width="20px"><input class="styled-text" type="text" name="vs_Name" size="27" id="vs_Name" Maxlength="20" tabindex="1"></td> <td valign="top"> <div class="styled-select"> <select style="width: 150px" name="select_vs_Name" id="select_vs_Name" onChange="vs_Name_Description(this, this.value)"> <option value="0" selected>&lt;&lt; Application Name</option> <option value="1">TELNET</option> <option value="2">HTTP</option> <option value="3">HTTPS</option> <option value="4">FTP</option> <option value="5">DNS</option> <option value="6">SMTP</option> <option value="7">POP3</option> <option value="8">H.323</option> <option value="9">REMOTE DESKTOP</option> <option value="10">PPTP</option> <option value="11">L2TP</option> <option value="12">Wake-On-Lan</option> </select> </div> </td> </tr> <tr> <th><script>I18N("h","Local IP");</script>:</th> <td valign="top" width="20px"><input class="styled-text" type="text" name="vs_LocalIP" size="27" id="vs_LocalIP" Maxlength="15" tabindex="2"></td> <td valign="top"> <div class="styled-select"> <select style="width: 150px" name="select_vs_LocalIP" id="select_vs_LocalIP" onChange="vs_LocalIP_Description(this, this.value)"> <option value="0" selected>&lt;&lt; Computer Name</option> </select> </div> </td> </tr> <tr> <th><script>I18N("h","Protocol");</script>:</th> <td width="20px"> <div class="styled-select" tabindex="3"> <select style="width: 120px" name="vs_Protocol" id="vs_Protocol" onChange="vs_Protocol_Description(this.value)"> <option value="6">TCP</option> <option value="17">UDP</option> <option value="256">Both</option> <option value="">Other</option> </select> </div> </td> <td>&nbsp;</td> </tr> <tr id="create_ProtocolNumber" style="display:none"> <th><script>I18N("h","Protocol Number");</script>:</th> <td valign="top" width="20px"><input class="styled-text" type="text" name="vs_ProtocolNumber" size="27" id="vs_ProtocolNumber" value="6" Maxlength="3" tabindex="4"></td> <td>&nbsp;</td> </tr> <tr id="create_ExternalPort"> <th><script>I18N("h","External Port");</script>:</th> <td valign="top" width="20px"><input class="styled-text" type="text" name="vs_ExternalPort" size="27" id="vs_ExternalPort" Maxlength="5" tabindex="5"></td> <td>&nbsp;</td> </tr> <tr id="create_InternalPort"> <th><script>I18N("h","Internal Port");</script>:</th> <td valign="top" width="20px"><input class="styled-text" type="text" name="vs_InternalPort" size="27" id="vs_InternalPort" Maxlength="5" tabindex="6"></td> <td>&nbsp;</td> </tr> <tr> <th class="linkstyle_1"><a href="Schedule.html"><script>I18N("h","Schedule");</script></a>:</th> <td width="20px"> <div class="styled-select" tabindex="7"> <select style="width: 120px" name="vs_Schedule" id="vs_Schedule"> <option value="Always">Always</option> </select> </div> </td> <td>&nbsp;</td> </tr> <tr> <td id="save_td" colspan="4"> <center><button type="button" class="styled_button_s" id="save_buttonFocus" onclick="document.getElementById('sumbit_CheckData').click()" tabindex="8" onkeyup="focusToFirstIndex(this)"><script>I18N("h","Apply");</script></button></center> </td> </tr> </tbody> </table> </div> </div> </form> <div id="CreatePopAlertMessage" style="display:none"> <div id="AlertPopRect"> <div id="AlertPopBody"> <table class="myAlertPop_table_b" id="waitSettingFinish" border="0" cellspacing="0"> <tbody> <tr> <td> <center><div id="Loading_pop_image2"></div></center> </td> </tr> <tr> <td label id="reciprocal_Number"></label></td> </tr> <tr> <td id="dialog_msg_black2"><script>I18N("h","Your changes are being saved.");</script></td> </tr> </tbody> </table> </div> </div> </div> <div id="DetectRouterConnection" style="display:none"></div> </div> <div id="footer"> <div id="copyright"><script>I18N("h","COPYRIGHT");</script></div> </div> </div> </div> <script type="text/javascript" charset="utf-8">$(document).ready(function(){$.validator.addMethod("checkProtocolNormal",function(c,a){var d=document.getElementById("vs_Protocol").value;var b=true;if(d!=""){b=true}else{if(c.length<1){b=false}}return b},jQuery.validator.messages.port_Check);$.validator.addMethod("checkPort",function(c,b){if(isNaN(c)){return false}var a=parseInt(c,10);if((a<=0)||(a>65535)){return false}return true},jQuery.validator.messages.port_Check);$.validator.addMethod("checkIPFormat",function(d,a){var c=/(^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))+$/;var b=true;if(c.test(d)){b=true}else{b=false}return b},jQuery.validator.messages.address_Check);$.validator.addMethod("checkIPAddress",function(d,b){var c=true;var a=COMM_IPv4MASK2INT(submask);if(lanIP==d){c=false}else{if(!COMM_ValidV4Format(d)||!COMM_ValidV4Addr(d)||!COMM_ValidV4HOST(d,a)){c=false}else{c=true}}return c},jQuery.validator.messages.address_Check);$("#virtualserver_form").each(function(a,b){$(b).validate({rules:{vs_Name:{required:true},vs_LocalIP:{required:true,checkIPFormat:true,checkIPAddress:true},vs_ProtocolNumber:{required:true,checkProtocolNormal:true},vs_ExternalPort:{required:true,checkPort:true,checkProtocolNormal:false},vs_InternalPort:{required:true,checkPort:true,checkProtocolNormal:false}},messages:{vs_Name:{required:jQuery.validator.messages.rule_Name},vs_ExternalPort:{required:jQuery.validator.messages.port},vs_ProtocolNumber:{required:jQuery.validator.messages.port},vs_InternalPort:{required:jQuery.validator.messages.port}},submitHandler:function(c){var d=c.value;closeCreateRulePOP(d)},debug:true})})});</script> </body> </html>